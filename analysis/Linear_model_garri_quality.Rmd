---
title: "Garri Functional Quality"
output: pdf_document
date: "2023-02-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r Check that I have the packages}
packages_used <- c("tidyverse", "ggplot2", "here", "stringr" )
ip <- installed.packages()
all_packages_installed <- TRUE
for (package in packages_used){
  if (!(package %in% ip[,"Package"])){
    print(paste("Please install package", package))
    all_packages_installed <- FALSE
  }
}#END packages_used
if (!all_packages_installed) stop("Need to install packages")
```

```{r Use here package}
require(here)
here::i_am("analysis/Linear_model_garri_quality.Rmd")
```

```{r Pull in the data}
library(tidyverse)
Oto_22_func <- read.csv(here::here("data", "OTOBI_2022PYT_FUNCTIONAL.csv"), head=T)

# Oto_22_func<-read.csv("/Users/ca384/Documents/ChinedoziRepo/GarriQuality/data/OTOBI_2022PYT_FUNCTIONAL.csv", head=T) # data for Otobi wit swelling power, swelling indx, bulk density and water absorbing capacity for 2022
Umu_22_func <- read.csv(here::here("data/UMU_2022_PYT_FUNCTIONAL.csv"), head=T)
# Umu_22_func<-read.csv("/Users/ca384/Documents/ChinedoziRepo/GarriQuality/data/UMU_2022_PYT_FUNCTIONAL.csv",head=T)# data for Umudike wit swelling power, swelling index, bulk density and water absorbing capacity for 2022

str(Oto_22_func)
str(Umu_22_func)
Oto_22_func$Genotype<-as.factor(Oto_22_func$Genotype)
Oto_22_func$wac.<-as.numeric(Oto_22_func$wac.)
Umu_22_func$Genotype<-as.factor(Umu_22_func$Genotype)
head(Umu_22_func)
head(Oto_22_func)
str(Oto_22_func)
str(Umu_22_func)
summary(Oto_22_func)
summary(Umu_22_func)
```

```{r creating plots}
boxplot(Oto_22_func$wac. , main="Water absorbing capacity of garri OTO",ylab = "WAC",xlab="Genotypes")

boxplot(Umu_22_func$wac. , main="Water absorbing capacity of garri UMU",ylab="WAC", xlab="Genotypes") #Removing outliers using the boxplot method

library(ggplot2)

par(mfrow=c(2,2))
boxplot(Oto_22_func$swelling.index, xlab="Genotypes", ylab="SI")
boxplot(Oto_22_func$swelling.power, ylab="SP",xlab="Genotypes")
boxplot(Oto_22_func$wac.,ylab="WAC", xlab="Genotypes")
boxplot(Oto_22_func$Bulk.Density, xlab="Genotypes", ylab="Bulk density")

```



```{r rename a column and adding new colun for otobi and umudike}
library("dplyr") #Using rename()

colnames(Oto_22_func)
colnames(Umu_22_func)
Umu_22_func <- Umu_22_func %>% 
       rename(Bulk.Density = AverageBD) # rename bulk density

Umu_22_func <- Umu_22_func %>% 
       rename(WAC= wac.) # rename wac. to WAC
Umu_22_func <- Umu_22_func %>% 
       rename(swelling.index= Swelling.index) # rename wac. to WAC



Oto_22_func <- Oto_22_func %>% 
       rename(WAC= wac.) # rename wac. to WAC for otobi
```

```{r remove column sn and add column for year and location}
library(tidyverse)
Umu_22_func <-Umu_22_func %>%
  add_column(location = "Umudike", year="2022") # add column with location and year for Umudike
head(Umu_22_func)
Umu_22_func <- subset(Umu_22_func, select=-c(sn)) # Remove the sn
head(Umu_22_func)
Umu_22_func <- Umu_22_func %>% relocate(location, year) # change the position of the location and year

Oto_22_func <- Oto_22_func %>%
  add_column(location = "Otobi", year="2022") %>% relocate(location, year)
# change the position of location and year from last column to the first column
```


```{r joining the two data frame}
Umu_oto_22 <- rbind(Oto_22_func, y=Umu_22_func)

str(Umu_oto_22)
Umu_oto_22$location <- as.factor(Umu_oto_22$location)
Umu_oto_22$year <- as.factor(Umu_oto_22$year)
str(Umu_oto_22)
glimpse(Umu_oto_22)
summary(Umu_oto_22)
plot(Umu_oto_22)
colnames(Umu_oto_22)
```

```{r importing 2019 functional properties data and renaming column}
Oto_19 <- read.csv(here::here("data", "functional-otobi2019_2020.csv"), head=T)

Umu_19 <- read.csv(here::here("data", "Umu_func_pyt2019_2020.csv"), head=T)

str(Oto_19)
str(Umu_19)

colnames(Oto_19)
colnames(Umu_19)

Oto_19 <- Oto_19 %>% 
       rename(Genotype= sample_id)

Umu_19 <- Umu_19 %>% 
       rename(Genotype= Genotypes)

Umu_19 <- Umu_19 %>% 
       rename(Moisture = X.moisture)

Umu_19 <- Umu_19 %>% 
       rename(Dry.Matter =X..Dry.Matter)

Oto_19 <- Oto_19 %>% 
       rename(swelling.index=Swelling.Index..final.initial.)

Oto_19 <- Oto_19 %>% 
       rename(swelling.power= SP)

Oto_19 <- Oto_19 %>% 
       rename(Bulk.Density= Bulk.Density..g.ml.)

colnames(Oto_19)
colnames(Umu_19)
dim(Oto_19)
dim(Umu_19)
str(Oto_19)


```

```{r select the need column from Oto_19 and Umu_19, Add year 2019, change the stucture of the data}

 #selecting  column

Oto_Selected <- Oto_19 %>% dplyr::select("location", "Genotype" ,"swelling.index", "swelling.power", "WAC"          , "Bulk.Density" )


#taking the average of the genotypes duplicates for otobi
Oto_Selected_aggre <- Oto_Selected %>% group_by(Genotype) %>%
  summarise_if(is.numeric, mean, na.rm = TRUE)

str(Oto_Selected_aggre)


Oto_Selected_aggre$Genotype <- as.factor(Oto_Selected_aggre$Genotype)

#Add columns for years and location
Oto_Selected_aggre  <-  Oto_Selected_aggre  %>%
  add_column(location = "Otobi",year = "2020") # change the year from 2019 to 2020
 


Umu_Selected <- Umu_19 %>% dplyr:: select('Genotype', 'swelling.index', 'swelling.power', 'WAC', 'Bulk.Density') # select the needed columns
 
Umu_Selected  <-  Umu_Selected  %>%
  add_column(location = "Umudike",year = "2020") # add location and year to the data frame


#add otobi and umudike 2019 data 
Umu_oto_19 <- rbind(Oto_Selected_aggre,Umu_Selected)
str(Umu_oto_19)
Umu_oto_19$location <-  as.factor(Umu_oto_19$location)
Umu_oto_19$year <-  as.factor(Umu_oto_19$year)
Umu_oto_19 <- data.frame(Umu_oto_19 )
Umu_oto_19 <-  Umu_oto_19  %>% relocate(location, year) # change the positions of year and location
```

```{r read in the dosage file and modify the row names to match with that in the phenotypic file}

snps_dosage <- read.csv(here::here("data/snps_199_genotype.csv"), head=T)

genotype_snps <- snps_dosage$X # get the genotype names from the snp dosage file to make it look like the names on the phenotype file

write.csv(genotype_snps,file=here("genotype_snps.csv")) # Had genotype names in new order (NR17C2aF10P011)

geno_snps <- read.csv(here::here("data/genotype_snps.csv"), head=T)  # had genotype names in old order eg (NR17F10C2aP011)


snps_dosage_N <- sub('IITA.TMS.','IITA-TMS-',geno_snps$X) # To ma sure all the genotypes names are correct . Rewrite the checks

 # combine snps_dosage_N with the dosage file

geno_name <- data.frame(snps_dosage_N) # with genotype name in correct order

new_snp <- cbind(snps_dosage_N,snps_dosage) # Combine the new and old order genotype names in one data frame.

new_snp_names <- (new_snp[-2]) #Deselect the column with the old names

new_snp_names <- new_snp_names %>% 
       rename("X" = "snps_dosage_N") #change the column name of the genotypes back to X

```

```{r read in 2020_2021 data for Otobi and Umudike}
Umu_21 <- read.csv(here::here("data", "Umu_2020_2021_PYT_Functional.csv"), head=T) # input genotypes planted in 2020 and harvested in 2021

Oto_21 <- read.csv(here::here("data", "OTOBI_2020_2021_PYT_Functional.csv"), head=T)

str(Umu_21)
dim(Umu_21)
Umu_21$Genotypes <- as.factor(Umu_21$Genotypes)
Umu_21 <- Umu_21 %>% 
       rename(Genotype= Genotypes) # rename Genotypes to genotype
Umu_21 <- Umu_21 %>% 
       rename(swelling.index= Swelling.index)

Umu_21$WAC <- as.numeric(Umu_21$WAC)
str(Oto_21)
Oto_21$Genotype <- as.factor(Oto_21$Genotype)
dim(Oto_21)
```

```{r combining 2021 Umudike and otobi in one data frame and adding year and location}

Umu_21  <-  Umu_21  %>%
  add_column(location = "Umudike",year = "2021") # add year and location to Umu_21
Oto_21  <-  Oto_21  %>%
  add_column(location = "Otobi",year = "2021") # add year and location to oto_21

 Umu_oto_21 <- rbind(Oto_21, Umu_21)# combining the two data frame

 Umu_oto_21 <-  Umu_oto_21 %>% relocate(location, year) # change the position of year and location
 
```

```{r combining all three years}
pyt_functional <- rbind(Umu_oto_19, Umu_oto_21, Umu_oto_22) # combine all three years
dim(pyt_functional)

```


